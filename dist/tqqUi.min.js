var dir=angular.module("tqq.ui",[]);
dir.directive("tqqPagination",function(){function e(e,a,t,i){var s=[],l=Math.ceil(e/a),n=Math.ceil(t/2),r=Math.floor(t/2);if(t>=l)for(var g=1;l>=g;g++)s.push(g);else if(n>=i)for(var d=1;t>=d;d++)s.push(d);else if(i>n&&l>=i+r){var o=i-n+1,c=i-n+t;for(o;c>=o;o++)s.push(o)}else if(i>n&&i+r>l)for(var u=l-t+1;l>=u;u++)s.push(u);return s}function a(e,a){for(var t=[],i=Math.ceil(e/a),s=1;i>=s;s++)t.push(s);return t}return{restrict:"EA",replace:!0,scope:{totalItems:"=",maxSize:"=",itemsPerPage:"=",ngModel:"=",hideLast:"=",tqqChange:"&",itemSelectHide:"="},link:function(t,i,s,l){if(t.atrs=s,!s.ngModel)throw'"ng-model" is undefined \n 中文:"ng-model"为必传参数。';if(!s.itemsPerPage)throw'"items-per-page" is undefined \n 中文:"items-per-page"为必传参数。';if(!s.totalItems)throw'"total-items" is undefined \n 中文:"total-items"为必传参数。';if(!(t.totalItems&&"number"==typeof t.totalItems||+t.totalItems===+t.totalItems))throw'"total-items" only Numbers \n 中文:"total-items"这个参数只能是数字。';var n,r,g;t.ngModel=t.ngModel||1,t.pageNum=Math.ceil(t.totalItems/(t.itemsPerPage||10)),t.pageArr=e(t.totalItems,t.itemsPerPage||10,t.maxSize||5,t.ngModel||1),t.allPageArr=a(t.totalItems,t.itemsPerPage||10),t.judge={first:"first",previous:"previous",next:"next",last:"last"},t.$watch("ngModel",function(a,i){n&&(t.pageArr=e(t.totalItems,t.itemsPerPage||10,t.maxSize||5,t.ngModel||1),t.tqqChange()),n=!0}),t.$watch("totalItems",function(){r&&(t.ngModel=1,t.pageArr=e(t.totalItems,t.itemsPerPage||10,t.maxSize||5,t.ngModel||1),t.allPageArr=a(t.totalItems,t.itemsPerPage||10),t.pageNum=Math.ceil(t.totalItems/(t.itemsPerPage||10))),r=!0}),t.$watch("itemsPerPage",function(){g&&(t.ngModel>1?t.ngModel=1:t.tqqChange(),t.pageArr=e(t.totalItems,t.itemsPerPage||10,t.maxSize||5,t.ngModel||1),t.allPageArr=a(t.totalItems,t.itemsPerPage||10),t.pageNum=Math.ceil(t.totalItems/(t.itemsPerPage||10))),g=!0}),t.updatePage=function(e){switch(e){case t.judge.first:t.ngModel=1;break;case t.judge.previous:t.ngModel>1&&t.ngModel--;break;case t.judge.next:t.ngModel<t.pageNum&&t.ngModel++;break;case t.judge.last:t.ngModel=t.pageNum;break;default:t.pageSelect=!1,t.ngModel=e}},t.updateItem=function(e){t.numSelect=!1,t.itemsPerPage=e},t.updateSelect=function(){t.pageSelect=!t.pageSelect},t.updateSelectNum=function(){t.numSelect=!t.numSelect}},template:'<nav><ul class="pagination mg-none {{atrs.sizeClass}}"><li ng-if="!hideLast"  ng-class="{disabled:ngModel===1}"><a href aria-label="First" ng-click="updatePage(judge.first)"><span ng-if="atrs.firstText">{{atrs.firstText}}</span><span aria-hidden="true" ng-if="!atrs.firstText">&laquo;</span></a></li><li ng-class="{disabled:ngModel===1}"><a href aria-label="Previous" ng-click="updatePage(judge.previous)"><span ng-if="atrs.previousText">{{atrs.previousText}}</span><span aria-hidden="true" ng-if="!atrs.previousText">&lsaquo;</span></a></li><li ng-repeat="val in pageArr track by $index" ng-class="{active:ngModel===val}"><a href ng-click="updatePage(val)">{{val}}</a></li><li ng-class="{disabled:ngModel===pageNum}"><a href aria-label="Next" ng-click="updatePage(judge.next)"><span ng-if="atrs.nextText">{{atrs.nextText}}</span><span aria-hidden="true" ng-if="!atrs.nextText">&rsaquo;</span></a></li><li ng-if="!hideLast" ng-class="{disabled:ngModel===pageNum}"><a href aria-label="Last" ng-click="updatePage(judge.last)"><span ng-if="atrs.lastText">{{atrs.lastText}}</span><span aria-hidden="true" ng-if="!atrs.lastText">&raquo;</span></a></li></ul><ul ng-if="!itemSelectHide" class="pagination pagination-init {{atrs.sizeClass}}"><li><a href class="left" ng-click="updateSelect()" ng-class="{active:pageSelect}">{{ngModel}}</a><li><a href="" class="init">/</a></li></li> <li><a href class="right" ng-class="{active:numSelect}" ng-click="updateSelectNum()">{{pageNum}}</a></li><div class="page-list" ng-if="pageSelect"><span ng-repeat="data in allPageArr track by $index" ng-class="{active:ngModel===data}" ng-click="updatePage(data)">{{data}}</span></div><div class="page-list num-select" ng-if="numSelect"><div>每页显示条数</div><span ng-repeat="data in [10,20,50,100,200] track by $index" ng-class="{active:itemsPerPage===data}" ng-click="updateItem(data)">{{data}}</span></div></ul></nav>'}});